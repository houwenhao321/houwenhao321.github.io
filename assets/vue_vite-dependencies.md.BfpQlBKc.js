import{_ as a,c as i,o as t,a2 as r}from"./chunks/framework.DRvQ3jNO.js";const p=JSON.parse('{"title":"Vite的依赖预构建过程是什么样的？","description":"","frontmatter":{},"headers":[],"relativePath":"vue/vite-dependencies.md","filePath":"vue/vite-dependencies.md"}'),o={name:"vue/vite-dependencies.md"};function l(d,e,n,s,h,c){return t(),i("div",null,[...e[0]||(e[0]=[r('<h1 id="vite的依赖预构建过程是什么样的" tabindex="-1">Vite的依赖预构建过程是什么样的？ <a class="header-anchor" href="#vite的依赖预构建过程是什么样的" aria-label="Permalink to &quot;Vite的依赖预构建过程是什么样的？&quot;">​</a></h1><p>Vite 之所以需要依赖预构建，主要是为了提高开发环境下的启动速度和热更新性能。</p><h2 id="为什么需要预构建" tabindex="-1">为什么需要预构建？ <a class="header-anchor" href="#为什么需要预构建" aria-label="Permalink to &quot;为什么需要预构建？&quot;">​</a></h2><h3 id="_1-兼容性问题" tabindex="-1">1. 兼容性问题 <a class="header-anchor" href="#_1-兼容性问题" aria-label="Permalink to &quot;1. 兼容性问题&quot;">​</a></h3><ul><li>将 CommonJS/UMD 转换为 ESM</li><li>解决模块间的依赖兼容性</li></ul><h3 id="_2-性能优化" tabindex="-1">2. 性能优化 <a class="header-anchor" href="#_2-性能优化" aria-label="Permalink to &quot;2. 性能优化&quot;">​</a></h3><ul><li>减少网络请求数量</li><li>提高模块加载速度</li></ul><h2 id="预构建过程" tabindex="-1">预构建过程 <a class="header-anchor" href="#预构建过程" aria-label="Permalink to &quot;预构建过程&quot;">​</a></h2><h3 id="_1-依赖扫描" tabindex="-1">1. 依赖扫描 <a class="header-anchor" href="#_1-依赖扫描" aria-label="Permalink to &quot;1. 依赖扫描&quot;">​</a></h3><p>Vite会扫描项目中的所有import语句，找出需要预构建的依赖。</p><p>javascript // 会被识别为需要预构建的依赖 import React from ‘react’ import _ from ‘lodash’</p><h3 id="_2-依赖收集" tabindex="-1">2. 依赖收集 <a class="header-anchor" href="#_2-依赖收集" aria-label="Permalink to &quot;2. 依赖收集&quot;">​</a></h3><p>收集所有需要预构建的依赖，包括：</p><ul><li>直接依赖</li><li>间接依赖</li><li>动态导入的依赖</li></ul><h3 id="_3-使用esbuild预构建" tabindex="-1">3. 使用esbuild预构建 <a class="header-anchor" href="#_3-使用esbuild预构建" aria-label="Permalink to &quot;3. 使用esbuild预构建&quot;">​</a></h3><p>javascript // vite.config.js export default { optimizeDeps: { include: [‘react’, ‘react-dom’], exclude: [‘some-dep’] } }</p><h3 id="_4-生成缓存" tabindex="-1">4. 生成缓存 <a class="header-anchor" href="#_4-生成缓存" aria-label="Permalink to &quot;4. 生成缓存&quot;">​</a></h3><p>预构建结果会缓存在 <code>node_modules/.vite</code> 目录下。</p><h2 id="配置选项" tabindex="-1">配置选项 <a class="header-anchor" href="#配置选项" aria-label="Permalink to &quot;配置选项&quot;">​</a></h2><h3 id="手动指定依赖" tabindex="-1">手动指定依赖 <a class="header-anchor" href="#手动指定依赖" aria-label="Permalink to &quot;手动指定依赖&quot;">​</a></h3><p>javascript // vite.config.js export default { optimizeDeps: { include: [ ‘some-special-dependency’ ] } }</p><h3 id="排除依赖" tabindex="-1">排除依赖 <a class="header-anchor" href="#排除依赖" aria-label="Permalink to &quot;排除依赖&quot;">​</a></h3><p>javascript export default { optimizeDeps: { exclude: [ ‘large-dependency’ ] } }</p><h3 id="自定义esbuild选项" tabindex="-1">自定义esbuild选项 <a class="header-anchor" href="#自定义esbuild选项" aria-label="Permalink to &quot;自定义esbuild选项&quot;">​</a></h3><p>javascript export default { optimizeDeps: { esbuildOptions: { target: ‘es2020’, define: { ‘process.env.NODE_ENV’: ‘“development”’ } } } }</p><h2 id="调试预构建" tabindex="-1">调试预构建 <a class="header-anchor" href="#调试预构建" aria-label="Permalink to &quot;调试预构建&quot;">​</a></h2><h3 id="查看预构建信息" tabindex="-1">查看预构建信息 <a class="header-anchor" href="#查看预构建信息" aria-label="Permalink to &quot;查看预构建信息&quot;">​</a></h3><p>bash npx vite --debug</p><h3 id="强制重新预构建" tabindex="-1">强制重新预构建 <a class="header-anchor" href="#强制重新预构建" aria-label="Permalink to &quot;强制重新预构建&quot;">​</a></h3><p>bash npx vite --force</p><h3 id="清除缓存" tabindex="-1">清除缓存 <a class="header-anchor" href="#清除缓存" aria-label="Permalink to &quot;清除缓存&quot;">​</a></h3><p>bash rm -rf node_modules/.vite</p><h2 id="最佳实践" tabindex="-1">最佳实践 <a class="header-anchor" href="#最佳实践" aria-label="Permalink to &quot;最佳实践&quot;">​</a></h2><ol><li><strong>合理配置</strong>：根据项目实际需求配置 <code>include</code> 和 <code>exclude</code></li><li><strong>监控性能</strong>：关注预构建时间，优化大型项目</li><li><strong>利用缓存</strong>：不要随意删除 <code>.vite</code> 缓存目录</li><li><strong>更新依赖</strong>：及时更新依赖以获得更好的预构建效果</li></ol><p>预构建是Vite性能优化的关键机制，理解其原理有助于我们更好地使用和优化Vite项目。</p>',35)])])}const b=a(o,[["render",l]]);export{p as __pageData,b as default};
